rules_version = '2';
service cloud.firestore {
match /databases/{database}/documents {

// Global rule required by the Canvas environment for all public data
match /artifacts/{appId}/public/data/{collection}/{document} {
  allow read, write: if request.auth != null; 
}

// ---------------------------------------------
// 1. Users Collection (Simplest Possible Create Rule)
// ---------------------------------------------
match /artifacts/{appId}/public/data/users/{uic} {
  // FOOLPROOF FIX: Allow creation if the user is signed in (authenticated).
  // This bypasses all complex validation checks that might cause a failure.
  allow create: if request.auth != null; 

  // Other operations remain secure
  allow read: if request.auth != null;
  allow update, delete: if false; // Deny updates/deletes for now
}

// ---------------------------------------------
// 2. Lost Items Collection (Simplified)
// ---------------------------------------------
match /artifacts/{appId}/public/data/lost_items/{itemId} {
  allow create, read, update: if request.auth != null;
  allow delete: if false;
}


}
}